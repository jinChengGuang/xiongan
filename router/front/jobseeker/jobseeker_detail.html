<!--顶部导航栏-->
<%- tname%>
<!--职位详情-->
<div class='container-fluid m-b-8 m-t-50'>
  <ul class="f-s-8">
    <li v-for="one in list" class="bg-white bor-r-5 p-10 pr row bor-b-sol bor-ea">
      <p class="w-100 m-b-10">
        <span class="f-s-10 f-s-f16 t-c-32 f-w-600 t-c-3232"> {{one.name}} </span>
        <span class='float-right t-c-0a0 f-s-f14 t-c-999' v-if='start < one.issue_time'>今天</span>
        <span class='float-right t-c-0a0 f-s-f14 t-c-999' v-if='start-86400 < one.issue_time && one.issue_time < start'>昨天</span>
        <span class="float-right t-c-0a0 f-s-f14 t-c-999" v-if='start-86400 > one.issue_time'> {{time.dateFormat('yyyy-MM-dd',one.issue_time)}}</span>
      </p>
      <p class="w-100 m-b-5">
        <span class="t-c-ff4 f-s-f15">{{one.pay}}</span>
      </p>
      <p class="w-100 m-b-5">
        <span class='f-s-f12 t-c-666'><i class="icon f-s-f12 p-r-3">&#xe8e0;</i>{{one.area}}</span>
        <span class='f-s-f12 t-c-666'><i class="icon f-s-f12 m-l-10 p-r-3">&#xe8e3;</i>{{one.education}}</span>
        <span class='f-s-f12 t-c-666'><i class="icon f-s-f12 m-l-10 p-r-3">&#xe8e1;</i>{{one.experience}}</span>
      </p>
      <p class="w-100 m-b-5 f-s-f11" >
        <span class="bor p-x-2 m-l-8 bor-sol bor-ccc br-5 p-l-5 dinb m-t-5 t-c-758 bg-f6" v-for='n in arry'>{{n}}</span>
      </p>
      <p class="w-100 m-b-5 m-t-15 bor-t-sol bor-ccc p-t-5">
        <a :href="'/front/jobseeker/job_company_list?id='+one.cid">
          <img src="one.logo" class='br-h h-h32 w-w32'>
          <span class='f-s-f13 t-c-999' v-if='one.cname.length >14'>{{one.cname.substring(1,15)+'...'}}</span>
          <span class='f-s-f13 t-c-999' v-if='one.cname.length <14'>{{one.cname}}</span>
          <span class="icon p-l-f2 m-l-5 f-s-f18 mt-2">&#xe7c4;</a></span>
        </a>
        <span class='collect-1 dinb h-h25 lh-25 w-w60 ta-c br-5 bor-sol bor-00bb right m-t-5' @click='cancel(one.id)' v-if='show_1==true'>收藏</span>
        <span class='collect-1 dinb h-h25 w-w60 ta-c lh-25 br-5 bor-sol bor-ccc right bg-00bb t-c-fff  m-t-5' v-if='show_1==false'>已收藏</span>
      </p>
    </li>
  </ul>
</div>
<!--岗位职责-->
<div v-for="one in list">
  <div class="container-fluid p-x-10 content bg-fff bor-t-sol bor-ea bor-b-sol m-b-15" >
    <div class='p-y-p2 f-s-8 bor-b-sol bor-ccc f-s-f15'>
      <i class="icon f-s-8 p-y-3 m-t-3 t-c-00a f-s-f15">&#xe8f3;</i>
      <span class='f-s-f15'>岗位职责</span>
    </div>
    <div class='content_1 f-s-6 t-c-666'>
      <p class='m-t-5 f-s-f14 t-c-7f' id='a'>{{statement}}</p>
    </div>
    <div class='bottom ta-c t-c-009 f-s-12' @click='block' v-show='one.statement.length > 80'>
      <i class="icon t-c-09a f-s-f35" >&#xe7c3;</i>
    </div>
  </div>
  <!--任职资格-->
  <div class="container-fluid content bg-fff bor-t-sol bor-ea bor-b-sol m-b-60">
    <div class='p-y-p2 f-s-8 bor-b-sol bor-ccc f-s-f15' id='icon'>
      <i class="icon f-s-8 p-y-3 m-t-3 t-c-00a f-s-f15">&#xe8f3;</i>
      <span class='f-s-f15'>任职资格</span>
    </div>
    <div class='content_1 f-s-6 t-c-666'>
      <p class='pt-3 f-s-f14 t-c-7f'>{{requirements}}</p>
    </div>
    <div class='bottom ta-c t-c-009 f-s-12' @click='content'  v-show='one.requirements.length > 80'>
      <i class="icon">&#xe7c3;</i>
    </div>
  </div>
</div>
<div class='container-fluid bg-d w-100 ta-c h-h45 lh-45 t-c-fff f-s-8 pf b-0' @click='record(list[0].id)'>投递</div>

<script> 
  new Vue({
    el:'#app',
    data:{
      list:[],
      benefit:[],
      arry:[],
      statement:'',
      statement_length:'',
      requirements:'',
      requirements_length:'',
      show_1:'',
      resume:[],
      resume_1:[],
      start:new Date().setHours(0,0,0,0)/1000,
      // record:[]
      name:'职位详情',
      datail_1:[],
    },
    mounted(){
      this.ajax.get('/job/detail/'+this.query.get('id'),(res)=>{
        this.list = res.data
        this.arry = res.data[0].benefit.split('|')
        this.statement = res.data[0].statement
        this.statement_length = res.data[0].statement
        this.requirements = res.data[0].requirements
        this.requirements_length = res.data[0].requirements
      },(err)=>{
        
      }),
      // 是否收藏
      this.ajax.get('/user/collect/collect_list',(res)=>{
        this.datail_1 = res.data
        if(this.datail_1){
          this.show_1 = false
        }else{
          this.show_1 = true
        }
      })
      // 个人简历
      this.ajax.get('/user/resume/datail',(res)=>{
        this.resume_1 = res.data
        console.log(this.resume_1)
      },(err)=>{

      })
    },
    methods: {
      block(){
        if(this.statement == this.statement_length && this.statement.length > 80){
          this.statement = this.statement.substring(0,80)+'...'
        }else{
          this.statement = this.statement_length
        }
      },
      content(){
        if(this.requirements == this.requirements_length && this.requirements.length > 80){
          this.requirements = this.requirements.substring(0,80)+'...'
        }else{
          this.requirements = this.requirements_length
        }
      },
      // 收藏
      cancel(jid){
        this.ajax.post('/collect/job',{ jid: jid},(res)=>{
        weui.toast('收藏成功', 1500);
        setTimeout('window.location.reload()',2000)
        },(err)=>{
        })
      },
      // 投递
      record(jid){
        if(this.resume_1 == 0){
          alert('您还没有简历,请创建简历')
          setTimeout("window.location.href='/front/jobseeker/new_resume'",2000)
        }else{
          this.ajax.post('/add/resume/record',{jid:jid, rid:this.resume_1[0].id}, (res)=>{
          weui.toast('投递成功', 2000);
          })
        }





        // if(this.resume == 0){
        //   alert('请您填写简历')
        // }else{
        //   this.ajax.post('/add/resume/record',{jid:jid, rid:this.resume.id}, (res)=>{
        //   weui.toast('投递成功', 2000);
        // })
        // }

      },
      go(){
        window.history.go(-1);
      }
    }
  })
</script>