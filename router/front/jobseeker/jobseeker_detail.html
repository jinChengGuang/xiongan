<!--顶部导航栏-->
<div class="container-fluid top pf t-0 l-0 bor-b-sol bor-ccc z-100">
  <div class="row tab h-45 lh-45 bg-fff">
    <div class="col-2 ">
      <i class="icon back f-s-15 v-a" @click='go'>&#xe86c;</i>
    </div>
    <div class="col-8 middle ta-c">
      <span>职位详情</span>
    </div>
    <div class="col-2"></div>
  </div>
</div>
<!--职位详情-->
<div class='container-fluid m-b-8 m-t-50'>
  <ul class="f-s-8 m-b-0">
    <li v-for="one in list" class=" bg-white bor-r-5 p-10 pr row">
      <p class="w-100 m-b-10">
        <span class="f-s-10 f-w-6"> {{one.name}} </span>
        <span class='f-s-8 f-w-6 float-right' v-if='start < one.issue_time'>今天</span>
        <span class='f-s-8 f-w-6 float-right' v-if='start-86400 < one.issue_time && one.issue_time < start'>昨天</span>
        <span class="float-right" v-if='start-86400 > one.issue_time'> {{time.dateFormat('yyyy-MM-dd',one.issue_time)}}</span>
      </p>
      <p class="w-100 m-b-5">
        <span class="t-c-ff5">{{one.pay}}</span>
      </p>
      <p class="w-100 m-b-5">
        <span><i class="icon">&#xe621;</i>{{one.area}}</span>
        <span><i class="icon">&#xe86a;</i>{{one.education}}</span>
        <span><i class="icon">&#xe68c;</i>{{one.experience}}</span>
      </p>
      <p class="w-100 m-b-5" >
        <span class="bor p-x-2 m-l-3 bor-sol bor-ccc t-c-d br-5 p-l-5 f-s-5 dinb m-t-5" v-for='n in arry'>{{n}}</span>
      </p>
      <p class="w-100 m-b-5">
        <i class="icon">&#xe621;</i>
        <a :href="'/front/company/company_list?id='+one.cid">
          <span>{{one.cname}}</span>
          <span class="icon p-l-f2 m-l-5">&#xe7c4;</a></span>
        </a>
        <span class='collect-1 dinb h-h25 w-w60 ta-c lh-25 br-5 bor-sol bor-ccc right' @click='cancel(one.id)' v-if='show_1==true'>收藏</span>
        <span class='collect-1 dinb h-h25 w-w60 ta-c lh-25 br-5 bor-sol bor-ccc right bg-d t-c-fff' v-if='show_1==false'>收藏</span>
      </p>
    </li>
  </ul>
</div>
<!--岗位职责-->
<div v-for="one in list">
  <div class="container-fluid content bg-fff bor-t-sol bor-ccc bor-b-sol bor-ccc m-b-3" >
    <div class='row p-y-p2 p-l-10 f-s-8 bor-b-sol bor-ccc '>
      <i class="icon f-s-8 p-y-3 p-r-r3 m-t-3">&#xe723;</i>
      <span>岗位职责</span>
    </div>
    <div class='content_1 f-s-6 t-c-666'>
      <p class='m-t-5' id='a'>{{statement}}</p>
    </div>
    <div class='bottom ta-c t-c-009 f-s-12' @click='block' v-show='one.statement.length > 80'>
      <i class="icon" >&#xe7c3;</i>
    </div>
  </div>
  <!--任职资格-->
  <div class="container-fluid content bg-fff bor-t-sol bor-ccc bor-b-sol bor-ccc m-b-50">
    <div class='row p-y-p2 p-l-10 f-s-8 bor-b-sol bor-ccc' id='icon'>
      <i class="icon f-s-8 p-y-3 p-r-r3 m-t-3">&#xe723;</i>
      <span>任职资格</span>
    </div>
    <div class='content_1 f-s-6 t-c-666'>
      <p class='pt-3'>{{requirements}}</p>
    </div>
    <div class='bottom ta-c t-c-009 f-s-12' @click='content'  v-show='one.requirements.length > 80'>
      <i class="icon">&#xe7c3;</i>
    </div>
  </div>
</div>
<div class='container-fluid bg-d w-100 ta-c h-h45 lh-45 t-c-fff f-s-8 pf b-0' @click='record(list[0].id)'>投递</div>

<script> 
  new Vue({
    el:'#app',
    data:{
      list:[],
      benefit:[],
      arry:[],
      statement:'',
      statement_length:'',
      requirements:'',
      requirements_length:'',
      show_1:true,
      resume:[],
      start:new Date().setHours(0,0,0,0)/1000,
      // record:[]
    },
    mounted(){
      this.ajax.get('/job/detail/'+this.query.get('id'),(res)=>{
        this.list = res.data
        this.arry = res.data[0].benefit.split('|')
        this.statement = res.data[0].statement
        this.statement_length = res.data[0].statement
        this.requirements = res.data[0].requirements
        this.requirements_length = res.data[0].requirements
      },(err)=>{
        
      })
      // 个人简历
      this.ajax.get('/user/resume',(res)=>{
        this.resume = res.data[0]
      },(err)=>{
        
      })
      // this.ajax.get('/user/resume/record',(res)=>{
      //   this.record = res.data[0]
      //   console.log(this.record)
      // })
    },
    methods: {
      block(){
        if(this.statement == this.statement_length && this.statement.length > 80){
          this.statement = this.statement.substring(0,80)+'...'
        }else{
          this.statement = this.statement_length
        }
      },
      content(){
        if(this.requirements == this.requirements_length && this.requirements.length > 80){
          this.requirements = this.requirements.substring(0,80)+'...'
        }else{
          this.requirements = this.requirements_length
        }
      },
      // 收藏
      cancel(jid){
        this.ajax.post('/collect/job',{ jid: jid},(res)=>{
        weui.toast('收藏成功', 2000);
        this.show_1 = false
        },(err)=>{
        })
      },
      // 投递
      record(jid){
        this.ajax.post('/add/resume/record',{jid:jid, rid:this.resume.id}, (res)=>{
          weui.toast('投递成功', 2000);
        })
      },
      go(){
        window.history.go(-1);
      }
    }
  })
</script>