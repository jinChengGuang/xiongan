<!--顶部导航栏-->
<div class="container-fluid fixed-top bor-b-sol bor-eee  align-middle">
  <div class="row h-45 lh-45 bg-white">
    <div class="col-2 p-x-0 p-l-10">
      <a href="javascript:history.go(-1)" class='t-c-0a0'>
        <i class="icon text-center f-s-f22 t-c-7c88">&#xe90f;</i>
      </a>
    </div>
    <div class="col-8 text-center">
      <span class="t-c-32 f-s-f17">企业认证</span>
    </div>
    <div class="col-2"></div>
  </div>
</div>
<div class="container-fluid bg-white m-t-53 m-b-45">
  <form action="#" class="f-s-8">
    <div class="row">
      <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
        <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司名称
          <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
        </label>
        <div class="col-6 p-x-0">
          <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 h-24 t-c-666 f-s-f14" placeholder="公司名称" v-model='group.name' id='name'>
        </div>
        <div class="col-2 align-self-center text-right p-x-0">
          <span class="t-c-ff0">*</span>  
        </div>
      </div>
    </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司性质
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 align-self-center pr">
        <i class="icon pa r-4 t-25 t-c-bf">&#xe62e;</i>
        <select class="bg-ef br-3 h-24 w-100 t-c-666 f-s-f14 p-l-2" v-model='group.kind' id="kind">
          <option value=''>请选择公司性质</option>
          <option v-for='t in type' :value='t'>{{t}}</option>
        </select>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">所属行业
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 align-self-center pr">
        <i class="icon pa r-4 t-11 t-c-bf">&#xe62e;</i>
        <select class="bg-ef br-3 h-24 w-100 t-c-666 f-s-f14 p-l-2" id='bcat' @change="linkage">
          <option value=''>请选择</option>
          <option v-for="b in big" :value="b.id">{{b.name}}</option>
        </select><br/>
        <i class="icon pa r-4 b-p12 t-c-bf">&#xe62e;</i>
        <select class="mt-2 bg-ef br-3 h-24 w-100 t-c-666 f-s-f14 p-l-2" id='mcat' v-model='group.iid' id='iid'>
          <option value=''>请选择</option>
          <option v-for="m in small" :value="m.id">{{m.name}}</option>
        </select>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">成立年份
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 align-self-center pr">
        <!--<input type="text" class="form-control form-filter yearpicker" readonly name="year" id="Year" />-->
        <!--<i class="icon pa r-22 t-25 t-c-bf">&#xe62e;</i>-->
        <input type="month" class="p-x-0 text-center bg-ef br-3 h-24 w-100 t-c-666 f-s-f14 p-l-2" v-model='group.age'>
        <!--<select class="bg-ef br-3 h-24 w-80 t-c-666 f-s-f14 p-l-2">
        <select class="bg-ef br-3 h-24 w-80 t-c-666 f-s-f14 p-l-2" v-model='group.age'>
          <option value=''>请选择年份</option>
          <option>1989</option>
          <option>1990</option>
          <option>1991</option>
        </select>-->
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司规模
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 align-self-center pr">
        <i class="icon pa r-4 t-25 t-c-bf">&#xe62e;</i>
        <select class="bg-ef br-3 h-24 w-100 t-c-666 f-s-f14 p-l-2" v-model='group.scope' id='scope'>
          <option value=''>请选择公司规模</option>
          <option v-for='s in scope'>{{s}}</option>
        </select>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">注册地址
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 t-c-666 f-s-f14 h-24" placeholder="请填写公司地址" v-model='group.address' id="address">
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司网址
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 t-c-666 f-s-f14 h-24" placeholder="请填写公司网址" id='website' v-model='group.website'>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司邮箱
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 t-c-666 f-s-f14 h-24" placeholder="请填写公司邮箱" id='email' v-model='group.email'>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">联系人姓名
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 t-c-666 f-s-f14 h-24" placeholder="请填写联系人姓名" v-model='group.contact_name' id="contact_name">
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">联系人电话
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <input type="text" class="form-control-plaintext border-0 w-100 p-y-0 t-c-666 f-s-f14 h-24" placeholder="请填写联系人电话" id='mobile' v-model='group.contact_mobile'>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">公司简介
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0">
        <textarea rows="3" placeholder="请填写完整的公司概况，保证真实有效" class="border-0 t-c-666 f-s-f14" v-model='group.summary' id="summary"></textarea>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">
        <span>上传营业执</span><br/>
        <span class="db p-l-p23">照</span>
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 file">
        <div class="w50 h-h50 bor-das bor-bbb text-center t-c-bbb" v-if='group.certificate'>
          <img :src="'http://xiongan.tset.hesq.com.cn/image/'+ group.certificate" class="w-100" >
        </div>
        <div class="w50 h-h50 bor-das bor-bbb lh-50 text-center f-s-f22 t-c-bbb" @click='openfile' v-else>
          <i class="icon">&#xe7ba;</i>
        </div>
        <input type="file" class="dn" @change='upload' id="cert">
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group bor-b-sol bor-eee w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">
        <span class="p-l-p7">上传法人</span><br/>
        <span>身份证原件</span>
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 file">

        <div class="float-left">
          <div class="w50 h-h50 bor-das bor-bbb text-center t-c-bbb" v-if='group.idcard_front'>
            <img :src="'http://xiongan.tset.hesq.com.cn/image/'+ group.idcard_front" class="w-100" >
          </div>
          <div class="w50 h-h50 bor-das bor-bbb lh-50 text-center f-s-f14 t-c-bbb" @click='openfile1' v-else>
            <i>正面</i>
          </div>
          <input type="file" class="dn" @change='upload1' id="front">
        </div>

        <div class="float-left m-l-10">
          <div class="w50 h-h50 bor-das bor-bbb text-center t-c-bbb" v-if='group.idcard_reverse'>
            <img :src="'http://xiongan.tset.hesq.com.cn/image/'+ group.idcard_reserve" class="w-100" >
          </div>
          <div class="w50 h-h50 bor-das bor-bbb lh-50 text-center f-s-f14 t-c-bbb" @click='openfile2' v-else>
            <i>反面</i>
          </div>
          <input type="file" class="dn"  @change='upload2' id="reverse">
        </div>


      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

  <div class="row">
    <div class="from-group w-93 ma p-y-p2 row">
      <label for="" class="col-4 col-from-label align-self-center m-b-0 p-x-0 f-s-f15 pr">
        <span>上传公司</span><br/>
        <span class="p-l-p7">LOGO</span>
        <span class="w-w1 dinb bg-f7 h-17 v-a ml-1 pa r-17 t-25"></span>
      </label>
      <div class="col-6 p-x-0 file">
        <div class="w50 h-h50 bor-das bor-bbb text-center t-c-bbb" v-if='group.logo'>
          <img :src="'http://xiongan.tset.hesq.com.cn/image/'+group.logo" class="w-100" >
        </div>
        <div class="w50 h-h50 bor-das bor-bbb lh-50 text-center f-s-f22 t-c-bbb" @click='openfile3' v-else>
          <i class="icon">&#xe7ba;</i>
        </div>
        <input type="file" class="dn" id = 'head3' @change='upload3' id='logo'>
      </div>
      <div class="col-2 align-self-center text-right p-x-0">
        <span class="t-c-ff0">*</span>  
      </div>
    </div>
  </div>

    <div class="row fixed-bottom">
      <a href="javascript:void(0)" class="btn br-0 w-100 bg-00b t-c-white" @click='submit'>确定</a>
      <!--<a href="/front/company/station" class="btn br-0 w-100 bg-primary t-c-white">确定</a>-->
    </div>
  </form>

  <!--用户弹框-->
  <div id="dialog1" style="display: none;">
    <div class="weui-mask z-1030"></div>
    <div class="weui-dialog f-s-8 br-5">
      <div class="weui-dialog__hd"><strong class="weui-dialog__title icon f-s-f40 t-c-f970">&#xe85e;</strong></div>
      <div class="weui-dialog__bd">您是否确定执行此操作?</div>
      <div class="weui-dialog__ft">
        <a class="weui-dialog__btn weui-dialog__btn_default" id='cancel' @click='canjob'>取消</a>
        <a class="weui-dialog__btn weui-dialog__btn_primary t-c-0bb20c" @click='submit'>确认</a>
      </div>
    </div>
  </div>

  <!--有没有注册弹层-->
      <div id="dialog2" style="display: none;">
        <div class="weui-mask z-1030"></div>
        <div class="weui-dialog f-s-8 br-5">
          <div class="weui-dialog__hd"><strong class="weui-dialog__title icon f-s-f40 t-c-f970">&#xe85e;</strong></div>
          <div class="weui-dialog__bd">您还没有注册账号，去注册?</div>
          <div class="weui-dialog__ft">
            <a class="weui-dialog__btn weui-dialog__btn_default" id='cancel' @click='can1'>取消</a>
            <a class="weui-dialog__btn weui-dialog__btn_primary t-c-0bb20c" @click='del1'>确认</a>
          </div>
        </div>
      </div>


        <!--失败弹层
      <div class="weui-toast weui-animate-fade-in dn" style='padding-top:22px' id='fail'>
        <i class="weui-icon_toast icon f-s-f45 t-c-white m-y-10">&#xe82c;</i> 
        <p class="weui-toast__content">请将信息填写完整！</p > 
      </div>-->

</div>

<script>
new Vue({
  el: '#app',
  data: {
   list:[],
   big:[],
   small:[],
   smallall:[],
   type:[],
   scope:[],
   group:{
     certificate:'',
     idcard_front:'',
     idcard_reverse:'',
     logo:'',
     iid:'',
     kind:'',
     age:'',
     scope:''
   },
   login:[]
  },
  mounted(){
    this.ajax.get('/company/industry/list',(res)=>{
      this.list = res.data
      let bigcat = []
      let smallall = []
      for(let cat of res.data){
        if(cat.fid == 0){
          bigcat.push(cat)
          continue
        }else{
          smallall.push(cat)
        }
      }
      this.big = bigcat
      this.smallall = smallall
    },(err)=>{
      this.msg.error('app',err.errmsg)
    }),
    //性质
    this.ajax.get('/company/kind/list',(res)=>{
      this.type = res.data
    },(err)=>{
      this.msg.error('app',err.errmsg)
    })
    //规模
    this.ajax.get('/company/scope/list',(res)=>{
      this.scope = res.data
    },(err)=>{
      this.msg.error('app',err.errmsg)
    })
  },
  methods: {
    del1(){
      window.location.href = '/front/login/register'
    },
    can1(){
      window.location.href = '/front/company/home'
    },
    upload(){
      // 第一个为id 第二个为config定义的规则
      this.uploadimg.working('cert','company').then((res)=>{
         if(res.errcode!==0){
          this.msg.error('app',res.errmsg)
          return
        }
        this.data.certificate = res.data[0].url
      })
    },
     upload1(){
      // 第一个为id 第二个为config定义的规则
      this.uploadimg.working('front','company').then((res)=>{
         if(res.errcode!==0){
          this.msg.error('app',res.errmsg)
          return
        }
        this.data.idcard_front = res.data[0].url
      })
    },
    upload2(){
      // 第一个为id 第二个为config定义的规则
      this.uploadimg.working('reverse','company').then((res)=>{
         if(res.errcode!==0){
          this.msg.error('app',res.errmsg)
          return
        }
        this.data.idcard_reverse = res.data[0].url
      })
    },
    upload3(){
      // 第一个为id 第二个为config定义的规则
      this.uploadimg.working('logo','company').then((res)=>{
         if(res.errcode!==0){
          this.msg.error('app',res.errmsg)
          return
        }
        this.data.logo = res.data[0].url
      })
    },
    openfile () {
     $(cert).click()
		},
    openfile1 () {
     $(front).click()
		},
    openfile2 () {
     $(reverse).click()
		},
    openfile3 () {
     $(logo).click()
		},
    linkage (){
      let bcat = document.getElementById('bcat')
      let mcat = document.getElementById('mcat')
      if (bcat.value != 0) {
        this.small=[]
        for (let samll of this.smallall) {
					if (samll.fid == bcat.value) {
						this.small.push(samll)
					}
				}
			} 
    },
    submit(){
      let name = $('#name').val()
      let kind = $('#kind').val()
      let iid = $('#iid').val()
      let scope = $('#scope').val()
      let address = $('#address').val()
      let contact_name = $('#address').val()
      let summary = $('#summary').val()
      let cert = $('#cert').val()
      let front = $('#front').val()
      let reverse = $('#reverse').val()
      let logo = $('#logo').val()
      if(name == ''){
        this.msg.error('app','公司名称不能为空')
        return false
      }else if(kind == 0){
        this.msg.error('app','公司性质不能为空')
        return false
      }else if(iid == ''){
        this.msg.error('app','所属行业不能为空')
        return false
      }else if(scope == ''){
        this.msg.error('app','公司规模不能为空')
        return false
      }else if(address == ''){
        this.msg.error('app','注册地址不能为空')
        return false
      }else if(contact_name == ''){
        this.msg.error('app','联系人姓名不能为空')
        return false
      }else if(summary == ''){
        this.msg.error('app','公司简介不能为空')
        return false
      }else if(cert == ''){
        this.msg.error('app','请上传营业执照')
        return false
      }else if(front == ''){
        this.msg.error('app','请上传身份证正面')
        return false
      }else if(reverse == ''){
        this.msg.error('app','请上传身份证反面')
        return false
      }else if(logo == ''){
        this.msg.error('app','请上传公司logo')
        return false
      }

      //  if(this.group.name == '' || this.group.kind == '' || this.group.iid =='' || this.group.age == '' || this.group.scope == '' || this.group.address == '' || this.group.contact_name == '' || this.group.summary == '' || this.group.certificate == '' || this.group.idcard_front == '' || this.group.idcard_reverse == '' || this.group.logo == ''){
      //   document.getElementById('fail').style.display = 'block'
      //   setTimeout("document.getElementById('fail').style.display='none'",1500)
      //   return
      // }

      let website = document.getElementById('website').value
      let email = document.getElementById('email').value
      let mobile = document.getElementById('mobile').value
      let webreg = /^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/
      let emareg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/ 
      let mobreg = /^0?(13[0-9]|15[012356789]|17[013678]|18[0-9]|14[57])[0-9]{8}$/
      if(!webreg.test(website)){
        weui.alert('输入的网址格式不正确')
        return false
      }else if(!emareg.test(email)){
        weui.alert('输入的邮箱格式不正确')
        return false
      }else if(!mobreg.test(mobile)){
        weui.alert('输入的手机号格式不正确')
        return false
      }
     

      let a = this.group.age.substring(0,4)
      this.group.age = a
      this.ajax.put('/company/add',this.group,(res)=>{
        weui.toast('提交成功,请等待审核', 1500);
        setTimeout("window.location.href='/front/company/station'",1500)
      },(err)=>{
        this.msg.error('app',err.errmsg)
      })   
    },
    canjob(){
     let dialog1 = document.getElementById('dialog1')
      dialog1.style.display = 'none'
   },
   surejob(){
      let dialog1 = document.getElementById('dialog1')
      dialog1.style.display = 'block'
   },
  }
})
</script>